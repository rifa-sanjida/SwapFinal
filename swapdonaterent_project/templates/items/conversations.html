{% extends 'base.html' %}

{% block content %}
<div class="conversations-container">
    <h1>Your Conversations</h1>

    {% if conversations %}
        <div class="conversation-list">
            {% for conversation in conversations %}
                <a href="{% url 'conversation_detail' conversation.id %}" class="conversation-item {% if conversation.unread_messages %}unread{% endif %}">
                    <div class="conversation-header">
                        <h3>{{ conversation.item.name }}</h3>
                        <span class="conversation-date">{{ conversation.updated_at|date:"M j, g:i a" }}</span>
                    </div>
<div class="conversation-participants">
                        {% for participant in conversation.participants.all %}
                            {% if participant != user %}
                                <strong>{{ participant.username }}</strong>
                            {% endif %}
                        {% endfor %}
                    </div>

                    <div class="conversation-preview">
                        {% with last_message=conversation.message_set.last %}
                            {% if last_message %}
                                <p>{{ last_message.content|truncatewords:10 }}</p>
                            {% else %}
                                <p>No messages yet</p>
                            {% endif %}
                        {% endwith %}
                    </div>
                </a>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-conversations">
            <h3>No conversations yet</h3>
            <p>Start a conversation by contacting a seller about their item!</p>
            <a href="{% url 'item_list' %}" class="btn btn-success">Browse Items</a>
        </div>
    {% endif %}
</div>
{% endblock %}
